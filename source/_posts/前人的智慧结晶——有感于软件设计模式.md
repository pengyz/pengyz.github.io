---
title: 前人的智慧结晶——有感于软件设计模式
tags:
  - 阳光
  - 随笔
categories:
  - 随笔
date: 2022-03-13 21:49:45
updated: 2022-03-13 21:49:45
---



# 软件开发面临的问题

对于程序员来说，使用程序解决现实生活中的各种实际问题是我们的主要任务。

在软件行业发展的早期，受限于硬件性能和计算机的普及程度，程序的规模都很小，解决的也都是一些相对简单的问题。在这个时期，结构化的程序设计被认为是软件开发的最佳实践。我们用一个个函数和变量来组织程序，以函数组织功能，以函数间的相互调用来组织起更复杂的逻辑，解决更实际的问题。

但是随着IT行业的发展，在摩尔定律之下，硬件性能已经有了飞跃式的提升，软件所关注问题的复杂度也在成倍提升。但是这里存在一个矛盾点：机器可以处理的问题复杂度是远超人脑的，随着硬件性能的提升，这个差距还会进一步放大。这种急速膨胀的软件复杂度给程序员造成了沉重的脑力负担。所以IT圈发明了高层抽象，各种应用开发框架，编程范式，编程思想，用以缓解这种越发尖锐的问题。

设计模式也是其中的一种重要的解决方案，在经典著作《设计模式 可复用面向对象软件的基础》一书中，Gof对前人的智慧进行了总结，提出了23种被广泛使用的设计模式并对它们进行了深入探讨。

本文中我们并不对设计模式本身进行探讨，感兴趣的同学可以去通读设计模式全书，相信会大有裨益。我们在本文中所要讲述的是我自己对对设计模式的几点思考。

<!-- more -->

# 什么是设计模式
> 每一个模式描述了一个在我们周围不断重复发生的问题，以及该问题的解决方案的核心。这样，你就能一次又一次地使用该方案而不必做重复劳动
> ——Alexander

设计模式代表了最佳实践，通常被有经验的面向对象的软件开发人员所采用。设计模式是软件开发人员在软件开发过程中面临的一般问题的解决方案。这些解决方案是众多软件开发人员经过相当长的一段时间的试验和错误总结出来的。

设计模式是一套被反复使用的、多数人知晓的、经过分类编目的、代码设计经验的总结。使用设计模式是为了重用代码、让代码更容易被他人理解、保证代码可靠性。 毫无疑问，设计模式于己于他人于系统都是多赢的，设计模式使代码编制真正工程化，设计模式是软件工程的基石，如同大厦的一块块砖石一样。项目中合理地运用设计模式可以完美地解决很多问题，每种模式在现实中都有相应的原理来与之对应，每种模式都描述了一个在我们周围不断重复发生的问题，以及该问题的核心解决方案，这也是设计模式能被广泛应用的原因。

所以设计模式是一种类似**经验公式**的东西，是前人总结出来的对某类问题的通用解决方案。我们学习和使用设计模式的原因在于借助这些最佳实践解决软件设计中的某些常见问题。


# 设计模式的本质

设计模式有很多种，我们使用设计模式来构建可伸缩性的代码以应对需求变更，但为什么？为什么那设计模式为何拥有这种能力？
在软件工程的实践之中，我们一直倡导 **“高内居低耦合”**，设计模式与这个目标是一致的，只是侧重于不同的方面：
**高内聚低耦合主要是针对设计而言的**，通过模块设计上的合理划分和整体的架构合计；**设计模式则主要是针对修改而言的**，它关注于在某些特定场景下采用特定的设计以限制修改的范围，核心关注点在于 ”控制变化“。**

我们思考这样一个问题：
> 如果需求的变更或者后续功能的扩展需要在代码的多个部分进行修改，我们就要对这些所有修改的部分进行详尽的测试，以确保所有的修改没有破坏现有逻辑。

直觉上可能认为这并不是一个很困难的事情，但当项目规模很大之后，这种由修改带来的额外测试工作量是很巨大的，而且某些边界条件很难被测试覆盖到进而由此引入潜在的问题，对软件的稳定性造成危害。这时候最好的情况就是，修改被限定在特定的范围内，尽可能小地对现有代码造成影响。
这就是设计模式的思路：通过对特定的问题的抽象设计，将变化的部分抽离出来做成接口（模板方法等），或将事件的发送和处理过程抽象并解耦合（观察者模式等）来做到抽离变化或依赖解耦，又或者是将对象的创建过程进行抽象以避免后续添加新的对象类型时创建代码和具体类型的耦合（工厂方法等），这些所有的抽象都是为了在后续的修改中代码中可能的化部分进行隔离和控制。


# 抽象的代价

C++语言的一个核心原则就是**零开销抽象(Zero cost Abstraction)**，也就是说C++提供的大部分抽象机制都不会带来额外的性能开销（或开销非常小）。从这里我们要认识到一点：抽象是有代价的，设计模式作为代码抽象的一种，它会付出代价：
1. 代码量增加和可读性下降
2. 性能降低

只是在大部分场景下，这些代价相对于它们带来的应对修改时的弹性优势来讲是值得的。在接触到嵌入式平台上的开发工作后，我更深刻地意识到架构设计和抽象所带来的开销并非在所有情况下都可以忽略，在一些极端性能敏感的领域，我们要慎用抽象。
还有一种情况值得我们警惕：对设计模式的滥用。
设计模式并非为了炫技而存在，我们要对它保持克制，不要做无谓的抽象，很多时候适当时机的重构比大而全的抽象要来的实在。对设计模式，我的观点是：过分的抽象和对模式的滥用带来的危害更大，滥用不如不用。